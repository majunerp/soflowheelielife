try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="77c6d281-6d8c-43e1-adc4-e1fcd3f98795",e._sentryDebugIdIdentifier="sentry-dbid-77c6d281-6d8c-43e1-adc4-e1fcd3f98795")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:crazygames-portal":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[77317],{53164:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(96540),n=r(9020);let a=e=>{let{game:t}=e,{setPlayingGame:r,resetGameInvites:a,setGameInviteLink:l}=s.useContext(n.Tz);return s.useEffect(()=>{if(t)return r(t),()=>{r(null),l(null),a()}},[t,a,l,r]),null}},68044:(e,t,r)=>{r.d(t,{u:()=>s,y:()=>n});let s="game-iframe";function n(){return document.getElementById(s)}},38037:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(74848),n=r(96540),a=r(64996);let l=function(e){return t=>{let{services:r}=n.useContext(a.A);return(0,s.jsx)(e,{services:r,...t})}}},71197:(e,t,r)=>{r.d(t,{A:()=>m});var s=r(96540),n=r(95420),a=r(77969),l=r(341),o=r(12896),i=r(59386),u=r(8056),c=r(40499),d=r(22672);async function f(e){let t=await fetch(e,{method:"GET"});return await t.text()}let m=e=>{let{gameId:t,gameTechnology:r}=e,{user:m}=s.useContext(i.R),p=s.useContext(u.A),[g]=(0,n.n)(d.P),[h]=(0,n.n)(d.kL),[k,w]=(0,a._)(d.IJ),y=s.useRef([]);return s.useEffect(()=>{if(!w.called||w.loading)return;let e=w.data?.gameData;w.error?(y.current.forEach(e=>{e({type:"requestGameDataNone"})}),y.current=[]):e&&e.dataUrl?f(e.dataUrl).then(t=>{let r={...e,data:t};y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:r,error:w.error}})}),y.current=[]}):(y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:w.error}})}),y.current=[])},[w]),s.useEffect(()=>{let e=e=>{m?(y.current=[t=>{let r=e.source;r&&r.postMessage(t,"*")},...y.current],k({variables:{id:t,technology:r},fetchPolicy:"network-only"})):y.current.forEach(e=>{e({type:"requestGameDataResponse",data:{store:void 0,error:null}})})},s=e=>{let{store:s,version:n,updatedAtTz:a,playedTime:l}=e.data,o=JSON.stringify(s);g({variables:{input:{data:o,id:t,technology:r,version:n,browser:p.browser?.name||"",playedTime:l,deviceType:(0,c.mO)(p.deviceType),updatedAtTz:a}}})},n=e=>{let{version:s}=e.data;h({variables:{input:{id:t,technology:r,version:s,browser:p.browser?.name||"",deviceType:(0,c.mO)(p.deviceType)}}})},a=t=>{if(t.data&&t.data.type===l.x)switch(t.data.event){case"requestGameData":e(t);break;case"updateGameData":case"replaceGameData":(0,o.isDefined)(m)&&s(t);break;case"clearGameData":(0,o.isDefined)(m)&&n(t);break;default:return}};return window.addEventListener("message",a),function(){window.removeEventListener("message",a)}},[g,k,h,t,r,m,p.browser,p.deviceType]),null}},22672:(e,t,r)=>{r.d(t,{IJ:()=>n,P:()=>a,kL:()=>l});var s=r(90321);let n=r(46961).Hc,a=s.Ru,l=s.Ss},29467:(e,t,r)=>{r.d(t,{A:()=>f});var s=r(96540),n=r(77969),a=r(68195),l=r(341),o=r(59386),i=r(45300),u=r(75782),c=r(59785),d=r(97307);let f=e=>{let{gameId:t}=e,{user:r}=s.useContext(o.R),{openedDrawer:f}=s.useContext(c.l9),{drawerOpeningPending:m}=s.useContext(c.Cx),{openDrawer:p}=s.useContext(c.lv),[g,h]=(0,n._)(d.Zp),[k,w]=(0,n._)(d.n4),[y,F]=(0,s.useState)(!1),[v,E]=(0,s.useState)(null),{data:b}=(0,a.IT)(d.J_,{skip:!r});(0,s.useEffect)(()=>{if(!m&&y&&v&&(r||f||(F(!1),E(null),v.postMessage({type:"showAuthPromptResponse",data:{error:{code:"userCancelled",message:"User cancelled the auth prompt"}}},"*")),r&&b&&!f)){F(!1),E(null);let e={type:"showAuthPromptResponse",data:{user:{id:b.me.id,username:`${b.me.username}`,profilePictureUrl:`${i.A.Instance.data.images}${b.me.profile.avatar}`}}};v.postMessage(e,"*")}},[f,y,r,v,b,m]);let x=(0,s.useCallback)(async(e,s)=>{let n={type:"requestUserTokenResponse",data:{}};if(!r){n.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(n,"*");return}if(h.loading)return;let a=await g({variables:{gameId:t,iframeUrl:s},fetchPolicy:"network-only"}),l=a.data?.userToken;a.error||!l?(console.error("User token retrieve error",a.error),n.data={error:{code:"unexpectedError",message:"Failed to retrieve user token"}}):n.data={token:l.token,expiresIn:l.expiresIn},e.postMessage(n,"*")},[r,h.loading,g,t]),I=(0,s.useCallback)(async e=>{let s={type:"requestXsollaUserTokenResponse",data:{}};if(!r){s.data={error:{code:"userNotAuthenticated",message:"The user is not authenticated"}},e.postMessage(s,"*");return}if(w.loading)return;let n=await k({variables:{gameId:t},fetchPolicy:"network-only"}),a=n.data?.xsollaUserToken;if(n.error||!a){console.error("Xsolla user token retrieve error",n.error);let e=n.error?.graphQLErrors?.[0]?.extensions?.code,t=n.error?.graphQLErrors?.[0]?.message;e?s.data={error:{code:e,message:t||""}}:s.data={error:{code:"unexpectedError",message:"Failed to retrieve Xsolla user token"}}}else s.data={token:a.token,expiresIn:a.expiresIn};e.postMessage(s,"*")},[t,k,r,w.loading]);return(0,s.useEffect)(()=>{let e=e=>{let t=()=>{setTimeout(()=>{p("signIn"),F(!0),E(e.source),u.A.removeFakeFullscreenListener(t)},100)};u.A.isFakeFullscreen()?u.A.addFakeFullscreenListener(t):(p("signIn"),F(!0),E(e.source))},t=t=>{if(t.data&&t.data.type===l.x)switch(t.data.event){case"requestUserToken":{let e=t.data;x(t.source,e.iframeUrl);break}case"requestXsollaUserToken":I(t.source);break;case"showAuthPrompt":e(t);break;default:return}};return window.addEventListener("message",t),function(){window.removeEventListener("message",t)}},[t,r,g,p,I,x]),null}},42293:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(74848),n=r(96540),a=r(30804);let l=function(e){return t=>{let r=n.useContext(a.H);return(0,s.jsx)(e,{experiment:r,...t})}}},75782:(e,t,r)=>{r.d(t,{A:()=>n});class s{removeFullscreenListener(e){this.eventKeys.forEach(t=>{document.removeEventListener(t,e)})}addFullscreenListener(e){this.eventKeys.forEach(t=>{document.addEventListener(t,e)})}addFakeFullscreenListener(e){this.fakeFullscreenListeners.push(e)}removeFakeFullscreenListener(e){this.fakeFullscreenListeners=this.fakeFullscreenListeners.filter(t=>t!==e)}isFullscreen(){let e=window.document;return!!(e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement)}isFakeFullscreen(){return this.isInFakeFullscreen}enteredFakeFullscreen(){this.isInFakeFullscreen||(this.isInFakeFullscreen=!0,this.fakeFullscreenListeners.forEach(e=>e()))}exitFakeFullscreen(){this.isInFakeFullscreen&&(this.isInFakeFullscreen=!1,this.fakeFullscreenListeners.forEach(e=>e()))}exitNativeFullscreen(){let e=window.document,t=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;return!!t&&(window.document.fullscreenElement&&t.call(e),!0)}constructor(){this.fakeFullscreenListeners=[],this.eventKeys=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],this.isInFakeFullscreen=!1,this.forceLockOrientation=async(e,t)=>{if(!t||"BOTH"===t||!("screen"in window)||!window.screen||!window.screen.orientation||!window.screen.orientation.lock)return;let r=null;try{await Promise.race([window.screen.orientation.lock("PORTRAIT"===t?"portrait":"landscape"),new Promise((t,s)=>{r=setTimeout(()=>{e.trackGenericError("timeoutError",{message:"Error in orientation lock timeout"}),s(Error("Orientation lock timeout"))},1e3)})])}catch(e){}finally{r&&clearTimeout(r)}}}}let n=new s},62603:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(74848),n=r(96540),a=r(89737);let l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>class extends n.Component{static async getInitialProps(r){let{trlService:s}=(0,a.V)(r);if(!r.req){let n=Promise.all(t.map(e=>s.loadTrlMessagesToLingui(e))),[a]=await Promise.all([e.getInitialProps?await e.getInitialProps(r):{},n]);return{...a}}let n=Promise.all(t.map(e=>s.getTrlMessages(e))),[l,o]=await Promise.all([e.getInitialProps?e.getInitialProps(r):Promise.resolve({}),n]);return{messages:o.reduce((e,t)=>Object.assign(e,t)),...l}}render(){let{...t}=this.props;return(0,s.jsx)(e,{...t})}}}}}]);